#!/usr/bin/env bash
# PATH: .husky/pre-push
set -euo pipefail

echo "ğŸš€ pre-push: tests + typecheck"

PNPM_CMD="pnpm"
UNAME="$(uname -s | tr '[:upper:]' '[:lower:]')"
if [[ "${OS:-}" == "Windows_NT" || "$UNAME" == *"mingw"* || "$UNAME" == *"msys"* ]]; then
  PNPM_CMD="pnpm.cmd"
fi

echo "ğŸ§ª Tests..."
$PNPM_CMD -s test || {
  echo "âŒ Testes falharam."
  exit 1
}

echo "ğŸ”¡ Typecheck..."
$PNPM_CMD -s typecheck || {
  echo "âŒ Typecheck falhou."
  exit 1
}

echo "âœ… pre-push OK"
