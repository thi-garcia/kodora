#!/usr/bin/env bash
# PATH: .husky/pre-commit
set -euo pipefail

echo "🔍 Running pre-commit checks..."

# Detecta ambiente e escolhe pnpm certo
PNPM_CMD="pnpm"
UNAME="$(uname -s | tr '[:upper:]' '[:lower:]')"
if [[ "${OS:-}" == "Windows_NT" || "$UNAME" == *"mingw"* || "$UNAME" == *"msys"* ]]; then
  PNPM_CMD="pnpm.cmd"
fi

echo "🖊️  Prettier check..."
$PNPM_CMD -s format:check || {
  echo "❌ Prettier encontrou diferenças. Rode: pnpm format"
  exit 1
}

echo "🧹 ESLint..."
$PNPM_CMD -s lint || {
  echo "❌ Lint falhou. Dica: pnpm lint:fix"
  exit 1
}

echo "✅ pre-commit OK"
